<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>trootski | What I’ve learned about cucumber js</title><meta name=description content="A description of my introduction to writing Cucumber.js tests"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=generator content="Hugo 0.78.2"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link href=/css/styles.css rel=stylesheet><link rel=canonical href=https://trootski.github.io/post/2018/03/what-ive-learned-about-cucumber-js/><script type=application/javascript src=/main.js></script><link rel=icon type=image/png href=/images/favicon.png></head><body><nav class="navbar fixed-top navbar-expand-sm navbar-dark bg-primary"><div class=container><a href=/ class=navbar-brand>trootski</a>
<button class="navbar-toggle d-xs-block d-md-none" type=button data-toggle=toggle data-target=#mainNavAltContent aria-controls=mainNavAltContent aria-expanded=false aria-label="Toggle Navigation">
<span class=navbar-toggler-icon></span></button><div class="navbar-collapse collapse" id=mainNavAltContent><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/ title="Blog page">Blog</a></li><li class=nav-item><a class=nav-link href=/work title="Work page">Work</a></li><li class=nav-item><a class=nav-link href=/about title="About page">About</a></li></ul><ul class="navbar-nav d-flex flex-row"><li class=nav-item><a href=https://twitter.com/trootski target=_blank class="link-transition twitter" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></li><li class=nav-item><a href=https://www.linkedin.com/in/troot1/ target=_blank class="link-transition linkedin" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30C64 50.568 50.568 64 34 64zM26.354 48.137V27.71h-6.789v20.427H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></li><li class=nav-item><a href=https://github.com/trootski target=_blank class="link-transition github" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></a></li></ul></div></div></nav><div class=container><div class=row><div class="col-12 col-md-3" role=navigation><div class="sidebar-holder sticky-top"><div class=sidebar-inner><div class=lead><img src=/images/avatar.jpeg class="img-thumbnail d-block framed mb-auto"><p>Blog for trootski. All opinions expressed are dubious and his own.</p></div><button class="btn btn-dark sidebar-toggle d-xs-block d-md-none" type=button data-toggle=collapse data-target=#collapseMore aria-expanded=false aria-controls=collapseMore>More</button><div class="d-none d-sm-block" id=sidebarCollapse><div class=most-recent><h3>Most Recent</h3><ul><li><a href=/post/2021/01/bond-project/>Bond Project</a></li><li><a href=/post/2020/12/>Spring Handle Constraint Violation</a></li><li><a href=/post/2019/04/story-templates/>Story Templates</a></li></ul></div><div class=tag-list><h3>Tags</h3><div class="tags btn-group"><a href=/tags/actionscript class="badge badge-primary" title="All pages with tag actionscript">actionscript</a>
<a href=/tags/agile class="badge badge-primary" title="All pages with tag agile">agile</a>
<a href=/tags/email class="badge badge-primary" title="All pages with tag email">email</a>
<a href=/tags/hardware class="badge badge-primary" title="All pages with tag hardware">hardware</a>
<a href=/tags/personal class="badge badge-primary" title="All pages with tag personal">personal</a>
<a href=/tags/play class="badge badge-primary" title="All pages with tag play">play</a>
<a href=/tags/python class="badge badge-primary" title="All pages with tag python">python</a>
<a href=/tags/software class="badge badge-primary" title="All pages with tag software">software</a>
<a href=/tags/software-engineering class="badge badge-primary" title="All pages with tag software-engineering">software-engineering</a>
<a href=/tags/spring-boot class="badge badge-primary" title="All pages with tag spring-boot">spring-boot</a>
<a href=/tags/testing class="badge badge-primary" title="All pages with tag testing">testing</a>
<a href=/tags/tooling class="badge badge-primary" title="All pages with tag tooling">tooling</a>
<a href=/tags/wordpress class="badge badge-primary" title="All pages with tag wordpress">wordpress</a></div></div></div></div></div></div><main class="col-12 col-md-8" role=main><article class="card border-0"><a href=/post/2018/03/what-ive-learned-about-cucumber-js/cucmber-logo.png><img src=/post/2018/03/what-ive-learned-about-cucumber-js/cucmber-logo_huf85b9403b472b26521885f8d22d70f3a_9057_730x547_fit_q97_box_2.png class=card-img-top alt="Cover image from What I’ve learned about cucumber js"></a><div class=card-body><h3 class=card-title>What I’ve learned about cucumber js</h3><small class=text-muted>March 29, 2018</small><div class=card-text><p><a href=https://github.com/cucumber/cucumber-js>CucumberJS</a> is a NodeJS implementation of a test runner which is powered by the <a href=https://github.com/cucumber/cucumber/wiki/Gherkin>Gherkin</a> syntax. It&rsquo;s integration with our team workflow has been a boon to clarity of purpose for stories in firstly SCRUM and now KANBAN. Here I will share some of things we&rsquo;re doing and the benefits we reap.</p><p>When writing a story the team gathers around a screen and we work on a shared text. Straight away this increases collaboration and removes a lot of later disagreements around &lsquo;I thought we said we would do X after Y&rsquo;. The Gherkin story states in a language somewhere between pseudo-code and a more traditional Agile story what is going to happen. This post is not an introduction to Gherkin syntax, you can read more about it <a href=https://github.com/cucumber/cucumber/wiki/Gherkin>here</a>.</p><p>The following is the format we generally use:</p><p>Feature: As a blogger
I would like to make blog posts
So I can share knowledge</p><p>Scenario: Write post with content
Given I have content
When I enter the content
And I publish the content
Then the content is published</p><p>The following are some key takeaways we have ascertained from this approach.</p><h3 id=keep-the-number-of-features-small-and-user-focused>Keep the number of features small and user focused</h3><p>A feature is something that the user uses. There is very little to be gained by implementing features or scenarios that the user can not directly be cognisant of because they will have no testable aspect. Rather, try to discover what the benefit to the user is of the story and find where that can be most easily integrated into an existing feature if one exists. This should reduce excess feature files or excessively large feature files. If a story covers only technical detail that does not directly impact the user then maybe it would be better suited to unit and functional tests.</p><p> </p><h3 id=establish-a-grammer-which-utilises-parameters>Establish a grammer which utilises parameters</h3><p>Early in the project try to create a grammer. Preferably one which accepts parameters. In future these can then be re-used to test other scenarios and increase the speed of testing. For example the following snippet improves on the first one and can be re-used to test different content.</p><p>Scenario: Write post with content
Given I have the following content</p><table><thead><tr><th>title</th><th>body</th></tr></thead><tbody><tr><td>My Post</td><td>The post was long and full of points</td></tr><tr><td>When I enter the content</td><td></td></tr><tr><td>And I publish the content</td><td></td></tr><tr><td>Then the content is published</td><td></td></tr></tbody></table><h3 id=access-the-scenario-name-to-customise-any-output>Access the scenario name to customise any output</h3><p>This is a pretty simple one. The before step exposes a reference object. From this object the name of the current scenario can be retrieved. I can then use this reference to persist items with unique names for the particular run.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>defineSupportCode</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;cucumber&#39;</span>);

<span style=color:#a6e22e>defineSupportCode</span>(<span style=color:#66d9ef>function</span> ({ <span style=color:#a6e22e>Before</span>, <span style=color:#a6e22e>After</span> }) {
    <span style=color:#a6e22e>Before</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>stepRef</span>) {
        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stub</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>stepRef</span> .<span style=color:#a6e22e>pickle</span>.<span style=color:#a6e22e>name</span> .<span style=color:#a6e22e>toLowerCase</span>() .<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/ /g</span>, <span style=color:#e6db74>&#39;-&#39;</span>);
    });
});
</code></pre></div><h3 id=export-an-image-or-logs-when-debugging-selenium>Export an image or logs when debugging selenium</h3><p>When debugging selenium based projects I find two sources of information very handy. The console logs from the previous browser session and a screenshot of the browser as it was after the test had run. This can be achieved using the <strong><a href=https://github.com/cucumber/cucumber-js/blob/master/docs/support_files/hooks.md>After</a></strong> hook. The code below assumes that the <strong>driver</strong> variable is already configured as a reference to an instance of <a href=https://seleniumhq.github.io/selenium/docs/api/javascript/index.html>Selenium WebDriver</a> or a similar library.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>defineSupportCode</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;cucumber&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>logging</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;selenium-webdriver/lib/logging&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs&#39;</span>);

<span style=color:#a6e22e>defineSupportCode</span>(<span style=color:#66d9ef>function</span> ({ <span style=color:#a6e22e>Before</span>, <span style=color:#a6e22e>After</span> }) {
    <span style=color:#a6e22e>After</span>(<span style=color:#66d9ef>function</span> () {
        <span style=color:#75715e>// Print whatever logs exist for this session
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>driver</span>.<span style=color:#a6e22e>manage</span>().<span style=color:#a6e22e>logs</span>().<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>logging</span>.<span style=color:#a6e22e>Type</span>.<span style=color:#a6e22e>BROWSER</span>)
            .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>entries</span>) =&gt; {
                <span style=color:#a6e22e>entries</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>entry</span>) =&gt; {
                    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;\[%s\] %s&#39;</span>, <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>level</span>.<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>message</span>);
                });
                <span style=color:#75715e>// Save a screenshot of the browser
</span><span style=color:#75715e></span>                <span style=color:#a6e22e>driver</span>.<span style=color:#a6e22e>takeScreenshot</span>()
                    .<span style=color:#a6e22e>then</span>((<span style=color:#a6e22e>pngString</span>) =&gt; {
                        <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>writeFileSync</span>(<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stub</span><span style=color:#e6db74>}</span><span style=color:#e6db74>.png\`, pngString, &#39;base64&#39;);
</span><span style=color:#e6db74>                    });
</span><span style=color:#e6db74>            });
</span><span style=color:#e6db74>    });
</span></code></pre></div></div><div class=card-footer><h5>Tags</h5><div class="tags btn-group" role=group aria-label="Tags list"><a href=/tags/testing class="badge badge-primary">Testing</a></div></div></div></article><div><ul class="nav justify-content-between"><li class=nav-item><a class=nav-link href=/post/2018/02/delete-last-word/ title="Delete last word">Older</a></li><li class=nav-item><a class=nav-link href=/post/2018/10/my-favourite-bash-shortcuts/ title="My favourite bash shortcuts">Newer</a></li></ul></div></main></div></div></body></html>